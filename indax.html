<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>codetbase 통합 관리자</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { display: flex; margin: 0; font-family: sans-serif; }
        nav { width: 250px; height: 100vh; background: #343a40; color: white; padding: 1rem; }
        main { flex: 1; padding: 2rem; background: #f8f9fa; }
        .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; border-left: 5px solid #007bff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        button.logout { background: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <nav>
        <h2>codetbase</h2>
        <p id="user-info">관리자님 환영합니다</p>
        <hr>
        <ul>
            <li>대시보드</li>
            <li>사용자 관리</li>
            <li>콘텐츠 관리</li>
            <li>시스템 설정</li>
        </ul>
        <button class="logout" onclick="signOut()">로그아웃</button>
    </nav>
    <main>
        <h1>대시보드</h1>
        <div class="card-grid">
            <div class="card"><h3>신규 유저</h3><p id="user-count">0명</p></div>
            <div class="card"><h3>오늘의 게시글</h3><p>0건</p></div>
            <div class="card"><h3>미처리 신고</h3><p>0건</p></div>
        </div>
    </main>

    <script>
        const SUPABASE_URL = "https://vmchoitkohbmbrsrnogo.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtY2hvaXRrb2hibWJyc3Jub2dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MjgxNTIsImV4cCI6MjA4MzUwNDE1Mn0.JYUwOlZgB3KzLArnwjrY_EMFA2UFGSOTtUFRdGwVUN8";
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 세션 체크 (로그인 안되어 있으면 로그인 창으로)
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                location.href = 'login.html';
            } else {
                document.getElementById('user-info').innerText = session.user.email;
                fetchStats();
            }
        }

        async function fetchStats() {
            // 예시: profiles 테이블에서 전체 유저 수 가져오기
            const { count, error } = await supabase
                .from('profiles')
                .select('*', { count: 'exact', head: true });
            
            if (!error) document.getElementById('user-count').innerText = count + '명';
        }

        async function signOut() {
            await supabase.auth.signOut();
            location.href = 'login.html';
        }

        checkSession();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>codetbase í†µí•© ê´€ë¦¬ì</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #4dabf7; --bg: #f8f9fa; --sidebar: #1a1d21; }
        body { margin: 0; font-family: 'Pretendard', -apple-system, sans-serif; background: var(--bg); color: #333; }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .wrapper { display: flex; width: 100%; }

        /* ì‚¬ì´ë“œë°” */
        nav { width: 260px; height: 100vh; background: var(--sidebar); color: white; padding: 25px; position: fixed; box-sizing: border-box; }
        nav h2 { color: var(--primary); margin-bottom: 30px; font-size: 22px; cursor: pointer; }
        nav ul { list-style: none; padding: 0; }
        nav ul li { padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.3s; color: #adb5bd; margin-bottom: 5px; }
        nav ul li:hover { background: rgba(255,255,255,0.1); color: white; }
        nav ul li.active { background: var(--primary); color: white; font-weight: bold; }
        
        /* ë©”ì¸ ì˜ì—­ */
        main { margin-left: 260px; padding: 40px; width: calc(100% - 260px); box-sizing: border-box; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-pill { background: #e9ecef; padding: 8px 15px; border-radius: 20px; font-size: 13px; font-weight: 500; }
        
        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .card h3 { margin: 0; font-size: 14px; color: #868e96; }
        .card .value { font-size: 32px; font-weight: 800; margin: 15px 0 5px; color: #212529; }

        /* ê²Œì„ ê´€ë¦¬ ì „ì²´ í™”ë©´ ëª¨ë“œ */
        #game-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: white; z-index: 100; flex-direction: column; }
        .game-header { padding: 15px 25px; background: #2c3e50; color: white; display: flex; align-items: center; gap: 20px; }
        .back-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .back-btn:hover { background: rgba(255,255,255,0.2); }
        iframe { flex: 1; border: none; width: 100%; }

        button.logout { background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 40px; }
    </style>
</head>
<body>

    <div id="dash-view" class="wrapper">
        <nav>
            <h2 onclick="location.reload()">codetbase</h2>
            <ul>
                <li class="active">ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œ</li>
                <li onclick="openGameManage()">ğŸ® ì½”ëƒ ê²Œì„ì¦ˆ ê´€ë¦¬</li>
                <li onclick="alert('ì¤€ë¹„ ì¤‘')">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</li>
            </ul>
            <button class="logout" onclick="signOut()" style="position: absolute; bottom: 25px; width: 210px;">ë¡œê·¸ì•„ì›ƒ</button>
        </nav>

        <main>
            <div class="header">
                <h1>í†µí•© ê´€ì œ ëŒ€ì‹œë³´ë“œ</h1>
                <div class="user-pill" id="user-info">ì ‘ì† ì¤‘...</div>
            </div>
            <div class="card-grid">
                <div class="card"><h3>ë©”ì¸ ì‚¬ìš©ì</h3><div class="value" id="count-codet">0 ëª…</div></div>
                <div class="card"><h3>ê²Œì„ì¦ˆ ì‚¬ìš©ì</h3><div class="value" id="count-games">0 ëª…</div></div>
                <div class="card"><h3>ë³´ì•ˆ ìƒíƒœ</h3><div class="value" style="color:#2b8a3e">ì•ˆì „</div></div>
            </div>
            <div id="recent-history" style="margin-top:20px; color:#888; font-size:14px;"></div>
        </main>
    </div>

    <div id="game-view">
        <div class="game-header">
            <button class="back-btn" onclick="closeGameManage()"><i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
            <span style="font-weight: bold;">ì½”ëƒ ê²Œì„ì¦ˆ í†µí•© ê´€ë¦¬ íŒ¨ë„</span>
        </div>
        <iframe src="game.html" id="game-frame"></iframe>
    </div>

    <script>
        const CODET_URL = "https://vmchoitkohbmbrsrnogo.supabase.co";
        const CODET_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtY2hvaXRrb2hibWJyc3Jub2dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MjgxNTIsImV4cCI6MjA4MzUwNDE1Mn0.JYUwOlZgB3KzLArnwjrY_EMFA2UFGSOTtUFRdGwVUN8";
        const _codet = supabase.createClient(CODET_URL, CODET_KEY);
        
        const GAME_URL = "https://utfrjzcnefsbuadnkdud.supabase.co";
        const GAME_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0ZnJqemNuZWZzYnVhZG5rZHVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MjE1MTYsImV4cCI6MjA4MjM5NzUxNn0.D3Za1nMw-x0JwOpkFuYceUHlagcpRdrpFqNUIP5Kjdc";
        const _games = supabase.createClient(GAME_URL, GAME_KEY);

        async function init() {
            const { data: { session } } = await _codet.auth.getSession();
            if (!session) return location.replace('login.html');
            document.getElementById('user-info').innerText = session.user.email;
            
            const { count: c1 } = await _codet.from('profiles').select('*', { count: 'exact', head: true });
            const { count: c2 } = await _games.from('profiles').select('*', { count: 'exact', head: true });
            document.getElementById('count-codet').innerText = (c1 || 0) + " ëª…";
            document.getElementById('count-games').innerText = (c2 || 0) + " ëª…";
        }

        // ê²Œì„ ê´€ë¦¬ ì°½ ì—´ê¸° (ì‚¬ì´ë“œë°” ì—†ì•°)
        function openGameManage() {
            document.getElementById('dash-view').style.display = 'none';
            document.getElementById('game-view').style.display = 'flex';
            document.getElementById('game-frame').contentWindow.location.reload();
        }

        // ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        function closeGameManage() {
            document.getElementById('game-view').style.display = 'none';
            document.getElementById('dash-view').style.display = 'flex';
            init(); // ë°ì´í„° ê°±ì‹ 
        }

        async function signOut() {
            await _codet.auth.signOut();
            location.replace('login.html');
        }

        init();
    </script>
</body>
</html>

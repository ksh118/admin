<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>codetbase í†µí•© ê´€ë¦¬ì</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #4dabf7; --bg: #f8f9fa; --sidebar: #1a1d21; }
        
        /* 1. ì „ì²´ êµ¬ì¡°ë¥¼ flexë¡œ ì„¤ì •í•˜ì—¬ ì˜ë¦¼ ë°©ì§€ */
        body { 
            display: flex; 
            margin: 0; 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background: var(--bg); 
            color: #333; 
            min-height: 100vh;
        }
        
        /* 2. ì‚¬ì´ë“œë°” í¬ê¸° ë° ìœ„ì¹˜ ì¡°ì • */
        nav { 
            width: 240px; /* ë„ˆë¹„ë¥¼ ì‚´ì§ ì¤„ì—¬ ì•ˆì •ì„± í™•ë³´ */
            min-width: 240px; 
            height: 100vh; 
            background: var(--sidebar); 
            color: white; 
            padding: 25px 20px; 
            position: sticky; /* fixed ëŒ€ì‹  stickyë¥¼ ì‚¬ìš©í•˜ë©´ ì˜ì—­ ì ìœ ê°€ í™•ì‹¤í•¨ */
            top: 0;
            box-sizing: border-box; 
            display: flex;
            flex-direction: column;
        }

        nav h2 { 
            color: var(--primary); 
            margin-bottom: 30px; 
            font-size: 24px; 
            letter-spacing: -1px;
            padding-left: 10px;
        }

        nav ul { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        nav ul li { 
            padding: 14px 18px; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: 0.2s; 
            color: #adb5bd; 
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        nav ul li:hover { background: rgba(255,255,255,0.05); color: white; }
        nav ul li.active { 
            background: var(--primary); 
            color: white; 
            font-weight: 600; 
            box-shadow: 0 4px 12px rgba(77, 171, 247, 0.3);
        }
        
        /* 3. ë©”ì¸ ì˜ì—­ ë„ˆë¹„ ìë™ ê³„ì‚° */
        main { 
            flex: 1; 
            padding: 40px; 
            box-sizing: border-box; 
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px; }
        .user-pill { background: #e9ecef; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 500; }
        
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.04); 
            transition: 0.3s;
        }
        .card:hover { transform: translateY(-3px); }
        .card h3 { margin: 0; font-size: 13px; color: #868e96; letter-spacing: 0.5px; }
        .card .value { font-size: 32px; font-weight: 800; margin: 15px 0 5px; color: #212529; }
        .card .site-tag { font-size: 11px; padding: 3px 8px; border-radius: 4px; font-weight: bold; }
        .tag-codet { background: #e7f5ff; color: #1971c2; }
        .tag-games { background: #fff4e6; color: #fd7e14; }

        .logout { 
            background: #ff6b6b; 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav>
        <h2>codetbase</h2>
        <ul>
            <li class="active">ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œ</li>
            <li onclick="location.href='game.html'">ğŸ® ì½”ëƒ ê²Œì„ì¦ˆ ê´€ë¦¬</li>
            <li>ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</li>
            <li>âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</li>
        </ul>
        <button class="logout" onclick="signOut()">ë¡œê·¸ì•„ì›ƒ</button>
    </nav>

    <main>
        <div class="header">
            <h1>í†µí•© ê´€ì œ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="user-pill" id="user-info">ì ‘ì† ì¤‘...</div>
        </div>

        <div class="card-grid">
            <div class="card">
                <h3>TOTAL USERS</h3>
                <div class="value" id="count-codet">0</div>
                <span class="site-tag tag-codet">codetbase</span>
            </div>

            <div class="card">
                <h3>GAMES USERS</h3>
                <div class="value" id="count-games">0</div>
                <span class="site-tag tag-games">ì—…ì†Œë“œ ê²Œì„ì¦ˆ</span>
            </div>

            <div class="card">
                <h3>NEW CONTENTS</h3>
                <div class="value">24</div>
                <span class="site-tag" style="background: #f1f3f5;">Today Update</span>
            </div>
        </div>
    </main>

    <script>
        // Supabase ì„¤ì • ë° ì´ˆê¸°í™” ë¡œì§ ìœ ì§€
        const CODET_URL = "https://vmchoitkohbmbrsrnogo.supabase.co";
        const CODET_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtY2hvaXRrb2hibWJyc3Jub2dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MjgxNTIsImV4cCI6MjA4MzUwNDE1Mn0.JYUwOlZgB3KzLArnwjrY_EMFA2UFGSOTtUFRdGwVUN8";
        const _codet = supabase.createClient(CODET_URL, CODET_KEY);

        const GAME_URL = "https://utfrjzcnefsbuadnkdud.supabase.co";
        const GAME_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0ZnJqemNuZWZzYnVhZG5rZHVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MjE1MTYsImV4cCI6MjA4MjM5NzUxNn0.D3Za1nMw-x0JwOpkFuYceUHlagcpRdrpFqNUIP5Kjdc";
        const _games = supabase.createClient(GAME_URL, GAME_KEY);

        async function init() {
            const { data: { session } } = await _codet.auth.getSession();
            if (!session) { location.replace('login.html'); return; }
            document.getElementById('user-info').innerText = session.user.email;

            fetchCodetStats();
            fetchGameStats();
        }

        async function fetchCodetStats() {
            const { count, error } = await _codet.from('profiles').select('*', { count: 'exact', head: true });
            if (!error) document.getElementById('count-codet').innerText = count.toLocaleString();
        }

        async function fetchGameStats() {
            try {
                const { count, error } = await _games.from('profiles').select('*', { count: 'exact', head: true });
                if (error) throw error;
                document.getElementById('count-games').innerText = count.toLocaleString();
            } catch (e) {
                document.getElementById('count-games').innerText = "ERR";
            }
        }

        async function signOut() {
            await _codet.auth.signOut();
            location.replace('login.html');
        }

        init();
    </script>
</body>
</html>
